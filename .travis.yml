language: c

install: true

branches:
  only:
    - master
    - dev

sudo: required

services: docker

before_install:
    - sudo add-apt-repository -y ppa:snaipewastaken/ppa
    - sudo apt-get update -q
    - sudo apt-get install criterion-dev -y
    - docker build -t redis-tries .
    - docker run -d -p 6379:6379 redis-tries
    - docker container list
    
jobs:
  include:
    - stage: build
      script: make all
      after_script: echo "Finished Building Implementation Library"
    - stage: test
      script:
          - make
          - make -C tests/
          - tests/test-libtrie
      after_script: echo "Finished Testing Implementation Library"
    - stage: module build
      script: make -C module/
      after_script: echo "Finished Building Module Library"
    - stage: module test
      script:
          - make -C hiredis/
          - make
          - make -C tests/
      after_script: echo "Finished Testing Module Library"
